<div class="admin-volunteers-module">
  <!-- Module Header -->
  <div class="module-header">
    <h1>Модуль «Волонтёры»</h1>
  </div>

  <!-- Stats Container -->
  <div class="stats-container">
    <div class="stats-content">
      <div class="stat-item">
        <div class="stat-label">Всего волонтёров</div>
        <div class="stat-value">{{ volunteers.length }}</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Активные записи</div>
        <div class="stat-value">{{ filteredVolunteers.length }}</div>
      </div>
    </div>
  </div>

  <!-- Search and Create Section -->
  <div class="actions-bar">
    <div class="search-container">
      <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (input)="filterVolunteers()"
        placeholder="Поиск по имени, роли, клубу, отделу, месту или мероприятию..."
        class="search-input"
      />
      <button *ngIf="searchTerm" class="clear-btn" (click)="clearSearch()">✕</button>
    </div>
    <button class="create-btn" (click)="openCreateModal()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
      Добавить волонтёра
    </button>
  </div>

  <!-- Volunteers Table -->
  <div class="table-container">
    <table class="volunteers-table">
      <thead>
        <tr>
          <th>№</th>
          <th>Имя</th>
          <th>Роль</th>
          <th>Контакт</th>
          <th>Назначен</th>
          <th>Клуб</th>
          <th>Отдел</th>
          <th>Площадка</th>
          <th>Мероприятие</th>
          <th>Действия</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let volunteer of filteredVolunteers; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ volunteer.name }}</td>
          <td>{{ volunteer.role }}</td>
          <td>{{ volunteer.contact }}</td>
          <td>
            <span class="status-badge" [class.assigned]="volunteer.isAssigned" [class.unassigned]="!volunteer.isAssigned">
              {{ volunteer.isAssigned ? 'Назначен' : 'Доступен' }}
            </span>
          </td>
          <td>{{ volunteer.clubName || 'N/A' }}</td>
          <td>{{ volunteer.departmentName || 'N/A' }}</td>
          <td>{{ volunteer.venueName || 'N/A' }}</td>
          <td>{{ volunteer.eventName || 'N/A' }}</td>
          <td>
            <button class="delete-btn" (click)="openDeleteModal(volunteer.volunteerId!)" title="Удалить волонтёра">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <polyline points="3 6 5 6 21 6" stroke-width="2"/>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" stroke-width="2"/>
              </svg>
            </button>
          </td>
        </tr>
        <tr *ngIf="filteredVolunteers.length === 0">
          <td colspan="10" style="text-align: center; padding: 40px;">
            {{ searchTerm ? 'Волонтёры, соответствующие запросу, не найдены' : 'Волонтёры отсутствуют' }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Create Volunteer Modal -->
  <div class="modal-overlay" *ngIf="showCreateModal" (click)="closeCreateModal()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Добавить нового волонтёра</h3>
        <button class="close-btn" (click)="closeCreateModal()">✕</button>
      </div>
      <form class="modal-form" [formGroup]="volunteerForm" (ngSubmit)="onSubmit()">
        <div class="form-grid">
          <div class="form-group">
            <label for="name">Имя волонтёра *</label>
            <input
              type="text"
              id="name"
              formControlName="name"
              placeholder="Введите имя волонтёра"
              [class.error]="volunteerForm.get('name')?.invalid && volunteerForm.get('name')?.touched"
            />
            <span class="error-msg" *ngIf="volunteerForm.get('name')?.invalid && volunteerForm.get('name')?.touched">
              Имя должно содержать не менее 3 символов
            </span>
          </div>

          <div class="form-group">
            <label for="role">Роль *</label>
            <input
              type="text"
              id="role"
              formControlName="role"
              placeholder="Введите роль (например, координатор, помощник)"
              [class.error]="volunteerForm.get('role')?.invalid && volunteerForm.get('role')?.touched"
            />
            <span class="error-msg" *ngIf="volunteerForm.get('role')?.invalid && volunteerForm.get('role')?.touched">
              Роль должна содержать не менее 3 символов
            </span>
          </div>

          <div class="form-group">
            <label for="contact">Контакт *</label>
            <input
              type="text"
              id="contact"
              formControlName="contact"
              placeholder="10-значный номер телефона"
              maxlength="10"
              [class.error]="volunteerForm.get('contact')?.invalid && volunteerForm.get('contact')?.touched"
            />
            <span class="error-msg" *ngIf="volunteerForm.get('contact')?.invalid && volunteerForm.get('contact')?.touched">
              Контакт должен содержать ровно 10 цифр
            </span>
          </div>

          <div class="form-group">
            <label for="isAssigned">Статус назначения *</label>
            <select id="isAssigned" formControlName="isAssigned">
              <option [value]="false">Доступен</option>
              <option [value]="true">Назначен</option>
            </select>
          </div>

          <div class="form-group">
            <label for="club_id">Клуб (необязательно)</label>
            <select id="club_id" formControlName="club_id">
              <option [value]="null">Выберите клуб</option>
              <option *ngFor="let club of clubs" [value]="club.club_id">{{ club.name }}</option>
            </select>
          </div>

          <div class="form-group">
            <label for="department_id">Отдел (необязательно)</label>
            <select id="department_id" formControlName="department_id">
              <option [value]="null">Выберите отдел</option>
              <option *ngFor="let dept of departments" [value]="dept.departmentId">{{ dept.name }}</option>
            </select>
          </div>

          <div class="form-group">
            <label for="venue_id">Площадка (необязательно)</label>
            <select id="venue_id" formControlName="venue_id">
              <option [value]="null">Выберите площадку</option>
              <option *ngFor="let venue of venues" [value]="venue.venue_id">{{ venue.name }}</option>
            </select>
          </div>

          <div class="form-group">
            <label for="event_id">Мероприятие (необязательно)</label>
            <select id="event_id" formControlName="event_id">
              <option [value]="null">Выберите мероприятие</option>
              <option *ngFor="let event of events" [value]="event.event_id">{{ event.name }}</option>
            </select>
          </div>
        </div>

        <div class="error-message" *ngIf="error">{{ error }}</div>

        <div class="modal-actions">
          <button type="button" class="cancel-btn" (click)="closeCreateModal()">Отмена</button>
          <button type="submit" class="submit-btn" [disabled]="volunteerForm.invalid || loading">
            {{ loading ? 'Создание...' : 'Создать волонтёра' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeDeleteModal()">
    <div class="modal-content modal-small" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Подтверждение удаления</h3>
        <button class="close-btn" (click)="closeDeleteModal()">✕</button>
      </div>

      <div class="modal-body">
        <p>Вы уверены, что хотите удалить этого волонтёра?</p>
        <p class="warning-text">Действие необратимо.</p>
      </div>

      <div class="error-message" *ngIf="error">{{ error }}</div>

      <div class="modal-actions">
        <button class="cancel-btn" (click)="closeDeleteModal()" [disabled]="loading">Отмена</button>
        <button class="delete-confirm-btn" (click)="confirmDelete()" [disabled]="loading">
          {{ loading ? 'Удаление...' : 'Удалить' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Success Toast -->
  <div class="toast toast-success" *ngIf="showSuccessToast">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="20 6 9 17 4 12"></polyline>
    </svg>
    <span>{{ toastMessage }}</span>
  </div>

  <!-- Error Toast -->
  <div class="toast toast-error" *ngIf="showErrorToast">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="15" y1="9" x2="9" y2="15"></line>
      <line x1="9" y1="9" x2="15" y2="15"></line>
    </svg>
    <span>{{ toastMessage }}</span>
  </div>
</div>
